<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shoot game</title>
    <script src="//use.edgefonts.net/bebas-neue.js"></script>
    <link rel="stylesheet" href='assets/css/style.css'>

</head>
<body>

    <!-- Preloader overlay -->
    <div class="overlay">
        <div class="logo"></div>
        <div class="percentLoaded">0%</div>
        <div class="progress"></div>
    </div>


    <!-- Information overlay -->
    <div class="info">

        <h1 class="title">Which controller do you want to use?</h1>

        <div class="back-button">
            <button>Back</button>
        </div>

        <div class="buttons">
            <button id="leap" class="choose_button">
                <p>A Leap Motion</p>
                <img src="/assets/img/icons/leap2_inverted.png">
            </button>
            <button id="socket" class="choose_button">
                <p>A smartphone</p>
                <img src="/assets/img/icons/phone-rod_inverted.png">
            </button>
            <button id="computer" class="choose_button">
                <p>A computer</p>
                <img src="/assets/img/icons/eke_inverted.png">
            </button>
        </div>

        <div class="chose hide two chose_computer">
            <div class="container pull-left">
                <p>Move your mouse to controll the gun,
                    <br>Press your mouse down to get power
                    <br> Release your mouse to shoot.
                </p>
            </div>
            <div class="container pull-right">
                <img src="/assets/img/fishtructions_L.png" class="instruct-img" />
            </div>
            <br>
            <div class="full-width">
                <button id="mouse" class="play">Play</button>
            </div>
        </div>

        <div class="chose hide three chose_socket">
            <div class="container pull-left ">
                <p>Scan the QR Code:
                    <br>
                    <br>
                    <div id="qrcode">

                    </div>
                </p>
            </div>
             <div class="container pull-center text">
                <p>Or go to
                    <br>
                    <span class="go_to_site">http://s.kerm.is/</span>
                    <br>and enter
                    <br>
                    <span class="room_id"></span>
                </p>
            </div>
            <div class="container pull-right">
                <p>Rotate your phone to <br />controll the gun.
                <br>Push the trigger to
                <br>to fire a bullet.
                <br>
                <img src="/assets/img/fishtructions_R_sm.png" class="instruct-img"></p>
            </div>
        </div>

        <div class="chose hide two chose_leap">
            <div class="container pull-left">
                <video width="320" height="240" autoplay loop>
                    <source src="videos/arm.mp4" type="video/mp4">
                        <source src="videos/arm.webm" type="video/webm">
                </video>
            </div>
            <div class="container pull-right width-50">
                <p>Move your arm left and right
                    <br>to control the gun. <br >
                    <br>Press <img src="/assets/img/icons/space_inverted.png" class="icon">
                    <br> to fire a bullet.
                </p>
            </div>
            <!-- <br>
            <br>
            <div class="full-width">
                <button class="play hide">Play</button>
            </div> -->
        </div>

    </div>
    <div class="pause">
        ll
    </div>

    <!-- <canvas id="canvas" style="z-index: 10; display:none;"></canvas>
    <div id="container"></div> -->


        <!-- <div class="preload">
            <div class="percentLoaded">0%</div>
            <div class="progress"></div>
        </div>

        <div class="overlay">
        <div class="info">
            <h3>Welcome to shoot.Kerm.is</h3>


            <div class="waiting">
                <p>Go to </p>
                <div class="browser"></div>
                <p>and enter the following code.</p>
                <div class="code"></div>
                <p>or scan the QR code.</p>
                <div id="qrcode"></div>
                <p>Want to play with your mouse?</p>
                <button id="mouse">yes!</button>
            </div>

            <div class="ready">
                <p>Click to shoot :) </p>
                <button id="start">Let's play!</button>
            </div>

        </div>
     </div> -->


    <article id="container">
        <div class="filler"></div>
      <!--  <div class="power"><div class="powerIndicator"></div></div> -->

        <!--  <div class="totall">
            <div class="level"></div>
            <div class="points"></div>
            <div class="balls"></div>
            <button class="next_level">Go to level <span></span></button> -->
        <!-- </div> -->


      <!--   <div class="level_overlay">
                <div class="info">
                    <h3 class="the_level">Wow you finished level <span></span>! Nice job.</h3>
                    <p class="the_points">U scored <span></span> points</p>
                    <p class="scored">Scored :  <span></span></p>
                    <p class="missed">Missed : <span></span></p>
                    <p class="the_bonus">Bonus : <span>0</span></p>
                    <button class="next_level">Go to level <span></span></button>
                </div>
        </div> -->

            <div class="ticket-holder">
                <div class="info-score shoot">
                    <div class="title">Shoot.kerm.is</div>
                    <div class="subtitle">Level <span class="level"></span></div>
                    <div class="remaining">
                        <span class="count"></span>&nbsp;balls remaining
                    </div>
                    <br>Score :&nbsp;
                    <span class="score"></span>
                    <a href="#" class="next-level-button">Press space for next level &rarr;</a>
                 </div>
            </div>

    </article>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//js.leapmotion.com/leap-0.5.0.min.js"></script>
    <script src="assets/js/libs/three.min.js"></script>
    <script src="assets/js/libs/physi.js"></script>
    <script src="assets/js/libs/socket.io.min.js"></script>
    <script src="assets/js/libs/qrcode.js"></script>
    <script src="assets/js/libs/stats.min.js"></script>
    <script src="assets/js/libs/dat.gui.min.js"></script>
    <script src="assets/js/libs/CCapture.min.js"></script>
    <script src="assets/js/libs/Whammy.js"></script>

    <script src="assets/js/partials/watch.js"></script>
    <script src="assets/js/partials/sos.js"></script>
    <script src="assets/js/partials/url.js"></script>
    <script src="assets/js/partials/room.js"></script>
    <script src="assets/js/partials/main.js"></script>
    <script src="assets/js/partials/physics.js"></script>
    <script src="assets/js/partials/leap.js"></script>
    <script src="assets/js/partials/canwebuildit.js"></script>
    <script src="assets/js/partials/shoot.js"></script>
    <script src="assets/js/partials/hitboxes.js"></script>
    <script src="assets/js/partials/preload.js"></script>
    <script src="assets/js/partials/levels.js"></script>

    <!-- load fonts -->
    <script src="assets/fonts/gentilis_bold.typeface.js"></script>
    <script src="assets/fonts/gentilis_regular.typeface.js"></script>
    <script src="assets/fonts/optimer_bold.typeface.js"></script>
    <script src="assets/fonts/optimer_regular.typeface.js"></script>
    <script src="assets/fonts/helvetiker_bold.typeface.js"></script>
    <script src="assets/fonts/helvetiker_regular.typeface.js"></script>
    <script src="assets/fonts/droid_sans_regular.typeface.js"></script>
    <script src="assets/fonts/droid_sans_bold.typeface.js"></script>
    <script src="assets/fonts/droid_serif_regular.typeface.js"></script>
    <script src="assets/fonts/droid_serif_bold.typeface.js"></script>

    <!-- Preload and sound stuff -->
    <script src="//code.createjs.com/preloadjs-0.4.1.min.js"></script>
    <script src="//code.createjs.com/soundjs-0.5.2.min.js"></script>


    <script>



            /**
             *
             * Call functions in watch.js
             *
             */




            document.addEventListener('click', function(event) {
               look.theUserIsShooting(event);
            }, false);

            window.addEventListener( 'resize', look.theWindowIsResizing, false );
            document.addEventListener( 'mousemove', look.theMouseIsMoving, false );
            document.addEventListener( 'keydown', look.theKeyIsGoingDown, false );

            document.addEventListener('fullscreenchange', look.theScreenIsGoingFullscreen, false);
            document.addEventListener('mozfullscreenchange', look.theScreenIsGoingFullscreen, false);
            document.addEventListener('webkitfullscreenchange', look.theScreenIsGoingFullscreen, false);
            document.addEventListener('pointerlockchange', look.thePointerIsBeingLocked, false);
            document.addEventListener('mozpointerlockchange', look.thePointerIsBeingLocked, false);
            document.addEventListener('webkitpointerlockchange', look.thePointerIsBeingLocked, false);
            document.addEventListener('pointerlockerror', look.thePointerLockHasGoneWrong, false);
            document.addEventListener('mozpointerlockerror', look.thePointerLockHasGoneWrong, false);
            document.addEventListener('webkitpointerlockerror', look.thePointerLockHasGoneWrong, false);

            $('#start').on('click', function() {
                //look.theUserIsLockingThePointer();

              $('.overlay').addClass('slideUp');

                shoot.controller = 'mobile';

                setTimeout(
                    function() {
                        // look.theUserIsLockingThePointer();
                        shoot.start = true;
                        $('.totall').addClass('active');
                    },
                    400
                );
            });

            $('#mouse').on('click', function() {

                 shoot.controller = 'mouse';

                 $('.overlay').addClass('slideUp');




                setTimeout(
                    function() {
                        // look.theUserIsLockingThePointer();
                        shoot.start = true;
                        $('.totall').addClass('active');
                    },
                    400
                );
            });

            // $('.next-level-button').on('click', function() { // .next_level!!

            //     shoot.nextLevel();

            // });

                var removeObject = [];

                 function reloadScene() {

                    //shoot.init();

                    // console.log('scene before ', scene);

                    $.each(scene.children, function(index, child) {

                        if(child != undefined) {


                            if(child.name == 'shootring-physics' || child.name == 'shootring-model' || child.name == 'shootback-model' || child.name == 'shootback-physics' || child.name == 'ball') {
                            //     console.log('remove');
                                // scene.remove(child);
                                removeObject.push(child);
                            }
                        }

                    });



                    for(var i = 0; i < removeObject.length; i++)
                    {
                        scene.remove(removeObject[i]);

                    }


                    balls = [];
                    //shootRings = [];

                    console.log('shootRings', shootRings);
                    shootRings = [];
                    console.log('shootRings 2', shootRings);



                    yeswecan.build_theshoot();
                    yeswecan.build_theball();
                     console.log('shootRings 3', shootRings);

                     console.log('scene after', scene);

                }


                // var changeRingColor = setInterval(function() {
                //     if(shoot.start) {

                //         if(!shoot.bonusColor) {
                //             console.log('random');
                //             shoot.random = Math.floor((Math.random() * shootRings.length));
                //             shoot.bonusColor = true;
                //             shootRings[shoot.random].material.color = 0x000000;
                //             console.log(shoot.random);
                //         }

                //         setTimeout(function() {
                //             console.log('remove random points', shoot.random);

                //             shootRings[shoot.random].material.color = 0xCC0030;
                //             clearInterval(changeRingColor);
                //             shoot.bonusColor = false;

                //         }, 3000 ) // (Math.random() * 15000) + 4000
                //     }
                // }, 1000); // (Math.random() * 50000) + 10000

    </script>


    <script type="text/javascript">


            $(function(){

                var qrcode = new QRCode("qrcode", {
                    text: url.currentURL + "/controller.html?roomNumber=" + room.id,
                    width: 200,
                    height: 200,
                    colorDark : "#094a69",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H
                });



                    $('.choose_button').on('click', function(){
                        var id = $(this).attr('id');
                        $('.info .title').html('How do you play the game?')
                        $('.back-button').show();
                        switch(id){
                            case 'socket' :
                                shoot.controller = 'mobile';
                                $('.buttons').hide();
                                $('.chose_socket').removeClass('hide').show();
                                // socketController.updateInstructions();
                                break;
                            case 'leap':
                                shoot.controller = 'leap';
                                $('.buttons').hide();
                                $('.chose_leap').removeClass('hide').show();
                                break;
                            case 'computer':
                                shoot.controller = 'mouse';
                                $('.buttons').hide();
                                $('.chose_computer').removeClass('hide').show();
                                break;
                        }
                    })

                    $('.back-button').on('click', function(){
                        $('.info .title').html('Which controller do you want to use?');
                        $('.chose').addClass('hide');
                        $('.chose_socket').hide();
                        $('.chose_leap').hide();
                        $('.chose_computer').hide();

                        $('.buttons').show();
                        $('.back-button').hide()
                    });

                    $('.play').on('click', function(){
                            shoot.start = true;
                            shoot.infoVisible = false;

                            shoot.rendering = true;

                            //$('.info').fadeOut();
                            $('.info').removeClass('slide_down');
                            //look.theUserIsLockingThePointer();
                            $('.info-score').addClass('active');

                            //shoot.addTargets();

                            scoreTick();
                    })

                    // $(document).on('click', '.next-level-button', function(){
                    //     game.nextLevel();
                    // })
            })



                function scoreTick() {
                    //ticks once a second for the score, checks for remaining time
                    // if (timeRemaining == 0) {
                    //     game.endGame();
                    // }


                    // if (shoot.start) {

                        // timeRemaining -= 1;
                        // game.updateScoreInfo();


                        //





                        // setTimeout(function() {
                        //     if(shoot.start){
                        //          // console.log('add target', t);
                        //          //    t++;
                        //            requestAnimationFrame(shoot.addTargets);
                        //             console.log('add target');
                        //         scoreTick();
                        //     }
                        // }, levels[shoot.level].speed);

                }




                $(window).focus(function() {
                        shoot.start = true;
                        shoot.rendering = true;


                        /**
                         *
                         * Check if we pressed play button and info overlay is gone
                         *
                         */


                        if(!shoot.infoVisible)
                        {
                            scoreTick();
                        }
                        // for (var i = 0; i < basketRings.length; i++) {
                        //     basketRings[i].speed = blockSpeed;
                        // };

                }).blur(function() {
                        console.log('stop render');
                        shoot.rendering = false;
                        shoot.start = false;

                        // for (var i = 0; i < basketRings.length; i++) {
                        //     blockSpeed = basketRings[i].speed;
                        //     basketRings[i].speed = 0;
                        //     // basketRings[i].__dirtyposition = false;
                        //     console.log(basketRings);
                        // };
                });

                console.log('shoot', performance.now());
                console.log('shoot', performance.now());

                // var blockSpeed = 0.7;
        </script>






</body>
</html>